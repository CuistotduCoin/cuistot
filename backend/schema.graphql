## https://gist.github.com/swalkinshaw/3a33e2d292b60e68fcebe12b62bbb3e2
## https://blog.apollographql.com/designing-graphql-mutations-e09de826ed97

interface Node {
  id: ID!
}

interface Timestamps {
  created_at: String!
  updated_at: String!
}

enum Gender {
  F
  M
  U
}

type Workshop implements Node & Timestamps {
  id: ID!
  created_at: String!
  updated_at: String!
  name: String!
  price: Int!
  duration: Int!
  min_gourmet: Int!
  max_gourmet: Int!
  description: String
  images: [S3Object!]!
  date: String!
  kitchen: Kitchen!
  cook: Cook!
  bookings: [Booking!]!
}

type Booking implements Node & Timestamps {
  id: ID!
  created_at: String!
  updated_at: String!
  amount: Int!
  gourmet: Gourmet!
  workshop: Workshop!
  evaluation: Evaluation
}

type Evaluation implements Timestamps {
  created_at: String!
  updated_at: String!
  booking: Booking!
  rating: Float!
  comment: String!
}

type Gourmet implements Node & Timestamps {
  id: ID!
  created_at: String!
  updated_at: String!
  email: String!
  first_name: String!
  last_name: String!
  image: S3Object
  gender: Gender
  birthdate: String
  address: String
  city: String
  zip_code: String
  location: String
  description: String
}

type Cook implements Node & Timestamps {
  id: ID!
  created_at: String!
  updated_at: String!
  is_pro: Boolean!
  business_name: String
  siren: String
  pro_email: String
  legal_first_name: String
  legal_last_name: String
  legal_birthdate: String
}

type Kitchen implements Node & Timestamps {
  id: ID!
  created_at: String!
  updated_at: String!
  name: String!
  address: String!
  city: String!
  zip_code: String!
  location: String!
}

type S3Object {
  bucket: String!
  key: String!
  region: String!
}

type WorkshopList {
  items: [Workshop!]!
  nextToken: String
}

type UserError {
  message: String!
  field: [String!] ## Path to input field which caused the error
}

input WorkshopInput {
  id: ID!
}

input KitchenInput {
  id: ID!
}

input CookInput {
  id: ID!
}

input GourmetInput {
  id: ID!
}

input BookingInput {
  id: ID!
}

input ImageInput {
  bucket: String!
  key: String!
  region: String!
}

type ImagePayload {
  image: S3Object
}

input CreateWorkshopInput {
  name: String!
  price: Int!
  duration: Int!
  min_gourmet: Int!
  max_gourmet: Int!
  description: String
  date: String!
  kitchen: KitchenInput!
  cook: CookInput!
}

type CreateWorkshopPayload {
  userErrors: [UserError!]!
  workshop: Workshop
}

input UpdateWorkshopInput {
  id: ID!
  name: String
  price: Int
  duration: Int
  min_gourmet: Int
  max_gourmet: Int
  description: String
  date: String
  kitchen: KitchenInput
  cook: CookInput
}

type UpdateWorkshopPayload {
  userErrors: [UserError!]!
  workshop: Workshop
}

type DeleteWorkshopPayload {
  userErrors: [UserError!]!
}

input CreateBookingInput {
  workshop: WorkshopInput!
  gourmet: GourmetInput!
  amount: Int
}

type CreateBookingPayload {
  userErrors: [UserError!]!
  booking: Booking
}

input UpdateBookingAmountInput {
  id: ID!
  amount: Int
}

type UpdateBookingAmountPayload {
  userErrors: [UserError!]!
  booking: Booking
}

type DeleteBookingPayload {
  userErrors: [UserError!]!
}

input CreateEvaluationInput {
  booking: BookingInput!
  rating: Float!
  comment: String!
}

type CreateEvaluationPayload {
  userErrors: [UserError!]!
  evaluation: Evaluation
}

input CreateGourmetInput {
  email: String!
  first_name: String!
  last_name: String!
  gender: Gender
  birthdate: String
  address: String
  city: String
  zip_code: String
  location: String
  description: String
}

type CreateGourmetPayload {
  userErrors: [UserError!]!
  gourmet: Gourmet
}

input UpdateGourmetInput {
  id: ID!
  email: String
  first_name: String
  last_name: String
  gender: Gender
  birthdate: String
  address: String
  city: String
  zip_code: String
  location: String
  description: String
}

type UpdateGourmetPayload {
  userErrors: [UserError!]!
  gourmet: Gourmet
}

type DeleteGourmetPayload {
  userErrors: [UserError!]!
}

input CreateCookInput {
  gourmet: GourmetInput!
  is_pro: Boolean
  business_name: String
  siren: String
  pro_email: String
  legal_first_name: String
  legal_last_name: String
  legal_birthdate: String
}

type CreateCookPayload {
  userErrors: [UserError!]!
  cook: Cook
}

input UpdateCookInput {
  id: ID!
  is_pro: Boolean
  business_name: String
  siren: String
  pro_email: String
  legal_first_name: String
  legal_last_name: String
  legal_birthdate: String
}

type UpdateCookPayload {
  userErrors: [UserError!]!
  cook: Cook
}

type DeleteCookPayload {
  userErrors: [UserError!]!
}

input CreateKitchenInput {
  name: String!
  address: String!
  city: String!
  zip_code: String!
  location: String!
}

type CreateKitchenPayload {
  userErrors: [UserError!]!
  kitchen: Kitchen
}

input UpdateKitchenInput {
  id: ID!
  name: String
  address: String
  city: String
  zip_code: String
  location: String
}

type UpdateKitchenPayload {
  userErrors: [UserError!]!
  kitchen: Kitchen
}

type DeleteKitchenPayload {
  userErrors: [UserError!]!
}

type EmptyPayload {
  userErrors: [UserError!]!
}

type Mutation {
  ## Workshops
  createWorkshop(input: CreateWorkshopInput!): CreateWorkshopPayload!
  updateWorkshop(input: UpdateWorkshopInput!): UpdateWorkshopPayload!
  deleteWorkshop(workshop_id: ID!): DeleteWorkshopPayload!
  addWorkshopImage(input: ImageInput!): ImagePayload!
  removeWorkshopImage(key: String!): EmptyPayload!

  ## Bookings
  createBooking(input: CreateBookingInput!): CreateBookingPayload!
  updateBookingAmount(input: UpdateBookingAmountInput!): UpdateBookingAmountPayload!
  deleteBooking(booking_id: ID!): DeleteBookingPayload!

  ## Evaluations
  createEvaluation(input: CreateEvaluationInput!): CreateEvaluationPayload!

  ## Gourmets
  createGourmet(input: CreateGourmetInput!): CreateGourmetPayload!
  updateGourmet(input: UpdateGourmetInput!): UpdateGourmetPayload!
  deleteGourmet(gourmet_id: ID!): DeleteGourmetPayload!
  updateGourmetImage(input: ImageInput!): ImagePayload!

  ## Cooks
  createCook(input: CreateCookInput!): CreateCookPayload!
  updateCook(input: UpdateCookInput!): UpdateCookPayload!
  deleteCook(cook_id: ID!): DeleteCookPayload!

  ## Kitchens
  createKitchen(input: CreateKitchenInput!): CreateKitchenPayload!
  updateKitchen(input: UpdateKitchenInput!): UpdateKitchenPayload!
  deleteKitchen(kitchen_id: ID!): DeleteKitchenPayload!
}

type Query {
  getWorkshop(workshop_id: ID!): Workshop!
  getWorkshops(limit: Int = 10, nextToken: String): WorkshopList!
  getGourmet(gourmet_id: ID!): Gourmet!
  getCook(cook_id: ID!): Cook!
  getBooking(booking_id: ID!): Booking!
  getKitchen(kitchen_id: ID!): Kitchen!
  getEvaluation(booking_id: ID!): Evaluation!
  getCurrentGourmet: Gourmet!
}

type Subscription {
  addWorkshop: CreateWorkshopPayload!
    @aws_subscribe(mutations: ["createWorkshop"])
}

schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}
